(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[320],{3825:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/do_task/circle_1",function(){return n(1563)}])},8104:function(t,e,n){"use strict";n.d(e,{K:function(){return r}});var r=(0,n(2804).cn)({key:"user",default:{name:""}})},1563:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return p}});var r=n(4051),a=n.n(r),u=n(5893),o=n(9008),i=n.n(o),c=n(7294),l=n(3328),s=n(2804),f=n(8104),h=function(t,e){e.map((function(e,n){t.beginPath(),t.arc(e.x,e.y,e.r,0,2*Math.PI,!0),t.setLineDash([5,5]),t.strokeStyle="black",t.lineWidth=1,t.stroke()}))},y=function(t,e){var n=[];return e.map((function(e,r){n.push([]);for(var a=0;a<100;a++)for(var u={x:e.r*Math.cos(2*Math.PI/100*a)+e.x,y:e.r*Math.sin(2*Math.PI/100*a)+e.y},o={a:u.y-e.y,b:-u.x+e.x,c:(u.x-e.x)*e.y-(u.y-e.y)*e.x},i=0;i<t.length;i++){var c=t[i];if(!(Math.sqrt((c[0].x-e.x)*(c[0].x-e.x)+(c[0].y-e.y)*(c[0].y-e.y))>=2*e.r))for(var l=1;l<c.length;l++){var s=c[l-1],f=c[l-0],h={a:s.y-f.y,b:-s.x+f.x,c:(s.x-f.x)*f.y-(s.y-f.y)*f.x};if(!((o.a*f.x+o.b*f.y+o.c)*(o.a*s.x+o.b*s.y+o.c)>=0)){var y=o.a*h.b-h.a*o.b;if(0!=y){var d={x:(o.b*h.c-h.b*o.c)/y,y:(h.a*o.c-o.a*h.c)/y},x={x:u.x-e.x,y:u.y-e.y},v=Math.sqrt(x.x*x.x+x.y*x.y);x.x/=v,x.y/=v;var m=(d.x-u.x)*x.x+(d.y-u.y)*x.y;if(Math.abs(m)>=e.r)continue;var p=Math.abs(d.x-s.x),g=Math.abs(d.x-f.x);if(0==p&&0==g)if(p=Math.abs(d.y-s.y),g=Math.abs(d.y-f.y),0==p&&0==g)n[n.length-1].push({index:a,t:f.t,x_target:u.x,y_target:u.y,x:d.x,y:d.y,d:m,f:f.f,altitude:f.altitude,azimuth:f.azimuth});else{var b=p/(p+g)*f.f+g/(p+g)*s.f,w=p/(p+g)*f.altitude+g/(p+g)*s.altitude,_=p/(p+g)*f.azimuth+g/(p+g)*s.azimuth,k=p/(p+g)*f.t+g/(p+g)*s.t;n[n.length-1].push({index:a,t:k,x_target:u.x,y_target:u.y,x:d.x,y:d.y,d:m,f:b,altitude:w,azimuth:_})}else{var S=p/(p+g)*f.f+g/(p+g)*s.f,j=p/(p+g)*f.altitude+g/(p+g)*s.altitude,A=p/(p+g)*f.azimuth+g/(p+g)*s.azimuth,E=p/(p+g)*f.t+g/(p+g)*s.t;n[n.length-1].push({index:a,t:E,x_target:u.x,y_target:u.y,x:d.x,y:d.y,d:m,f:S,altitude:j,azimuth:A})}break}}}}})),n},d=n(1163);function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function v(t,e,n,r,a,u,o){try{var i=t[u](o),c=i.value}catch(l){return void n(l)}i.done?e(c):Promise.resolve(c).then(r,a)}function m(t){return function(t){if(Array.isArray(t))return x(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return x(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}l.kL.register(l.f$,l.od,l.jn,l.u,l.De);var p=function(){var t=(0,d.useRouter)(),e=(0,c.useRef)(null),n=(0,c.useState)(null),r=n[0],o=n[1],l=(0,c.useState)(null),x=l[0],p=l[1],g=(0,c.useState)({w:0,h:0}),b=g[0],w=g[1],_=(0,c.useState)([]),k=_[0],S=_[1],j=(0,c.useRef)(),A=(0,c.useRef)(),E=(0,c.useState)([]),M=E[0],z=E[1],N=(0,c.useState)([]),P=N[0],T=N[1],C=(0,c.useState)(0),L=C[0],I=C[1],O=-10,R=-10,D=(0,s.sJ)(f.K);(0,c.useEffect)((function(){w({w:window.innerWidth,h:window.innerHeight});var t=[];t.push({x:100,y:200,r:50},{x:300,y:200,r:50},{x:500,y:200,r:50},{x:700,y:200,r:50},{x:100,y:400,r:50},{x:300,y:400,r:50},{x:500,y:400,r:50},{x:700,y:400,r:50},{x:100,y:600,r:50},{x:300,y:600,r:50},{x:500,y:600,r:50},{x:700,y:600,r:50}),S(t),I(performance.now())}),[]),(0,c.useEffect)((function(){console.log(b),null==r?o(e.current):p(r.getContext("2d"))}),[b]),(0,c.useEffect)((function(){if(null!=x){r.style.width=b.w,r.style.height=b.h,r.width=b.w,r.height=b.h,h(x,k);var t=!0,e=!1,n=void 0;try{for(var a,u=["touchstart","mousedown"][Symbol.iterator]();!(t=(a=u.next()).done);t=!0){var o=a.value;r.addEventListener(o,(function(t){console.log("touch start"),T(m(A.current).concat([[]]))}))}}catch(S){e=!0,n=S}finally{try{t||null==u.return||u.return()}finally{if(e)throw n}}var i=!0,c=!1,l=void 0;try{for(var s,f=["touchend","mouseup"][Symbol.iterator]();!(i=(s=f.next()).done);i=!0){var y=s.value;r.addEventListener(y,(function(t){console.log("touch end"),O=-10,R=-10}))}}catch(S){c=!0,l=S}finally{try{i||null==f.return||f.return()}finally{if(c)throw l}}var d=!0,v=!1,p=void 0;try{for(var g,w=["touchmove","mousemove"][Symbol.iterator]();!(d=(g=w.next()).done);d=!0){var _=g.value;r.addEventListener(_,(function(t){t.preventDefault();var e,n;t.touches&&t.touches[0]&&"undefined"!==typeof t.touches[0].force&&t.touches[0].force>0&&t.touches[0].force;var r=t.touches?t.touches[0]:null;if(r){if(e=t.touches[0].pageX-t.target.offsetLeft,n=t.touches[0].pageY-t.target.offsetTop,-10==O)return O=e,void(R=n);void 0==r.altitudeAngle&&(r.altitudeAngle=-10,r.azimuthAngle=-10);var a=performance.now(),u=A.current;u[u.length-1].push({x:e,y:n,t:a-L,f:r.force,altitude:r.altitudeAngle,azimuth:r.azimuthAngle}),T(m(u)),z(m(j.current).concat([{x:e,y:n,t:a-L,f:r.force,altitude:r.altitudeAngle,azimuth:r.azimuthAngle}])),0!=r.force&&(x.beginPath(),x.moveTo(O,R),x.lineTo(e,n),x.lineCap="round",x.strokeStyle="blue",x.setLineDash([]),x.lineWidth=1,x.stroke())}O=e,R=n}))}}catch(S){v=!0,p=S}finally{try{d||null==w.return||w.return()}finally{if(v)throw p}}}}),[x]),(0,c.useEffect)((function(){j.current=m(M)}),[M]),(0,c.useEffect)((function(){A.current=m(P)}),[P]);var W=function(){var e,n=(e=a().mark((function e(n){var r,u,o,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=y(P,k),(u={}).task={username:D.name,type:"circle_1"},u.results=[],k.map((function(t,e){var n=r[e],a=0;n.map((function(t){a+=Math.abs(t.d)})),0!=n.length?(a/=n.length,a=100*(1-5*(a/=t.r))):a=-1,u.results.push({type:"circle",score:a,x:t.x,y:t.y,r:t.r})})),u.results_time_series=r,console.log(u),e.next=9,fetch("".concat("https","://").concat("lab.nghmst.com/sketch_hit/backend","/save_result"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}).catch((function(){return null}));case 9:return o=e.sent,e.next=12,o.json().catch((function(){return null}));case 12:i=e.sent,console.log(i),0==i.result?(alert("\u9001\u4fe1\u304c\u7d42\u4e86\u3057\u307e\u3057\u305f"),t.push("/")):alert("\u9001\u4fe1\u306b\u5931\u6557\u3057\u307e\u3057\u305f");case 16:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function o(t){v(u,r,a,o,i,"next",t)}function i(t){v(u,r,a,o,i,"throw",t)}o(void 0)}))});return function(t){return n.apply(this,arguments)}}(),X=function(){z([]),T([]),x.clearRect(0,0,r.width,r.height),h(x,k)};return(0,u.jsxs)("div",{children:[(0,u.jsxs)(i(),{children:[(0,u.jsx)("title",{children:"Apple Pencil Test"}),(0,u.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,u.jsx)("div",{className:"relative",children:(0,u.jsx)("canvas",{ref:e,className:"absolute bg-gradient-to-br from-slate-300 to-slate-400"})}),(0,u.jsxs)("div",{className:"absolute flex flex-col justify-center mx-auto top-8 left-72",children:[(0,u.jsxs)("div",{className:"mb-2",children:["\u3042\u306a\u305f\u306e\u540d\u524d\uff1a ",D.name]}),(0,u.jsx)("div",{children:"\u70b9\u7dda\u306e\u5186\u3092\u306a\u305e\u3063\u3066\u304f\u3060\u3055\u3044"})]}),(0,u.jsx)("div",{className:"absolute px-4 py-2 text-white bg-orange-800 top-4 right-4 rounded-md",onClick:function(t){return W(t)},children:"\u7d50\u679c\u3092\u9001\u4fe1"}),(0,u.jsx)("div",{className:"absolute px-2 py-2 text-white bg-black top-4 left-4 rounded-md",onClick:function(t){X()},children:"clear canvas"})]})}}},function(t){t.O(0,[570,865,774,888,179],(function(){return e=3825,t(t.s=e);var e}));var e=t.O();_N_E=e}]);