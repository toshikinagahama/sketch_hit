(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[320],{3825:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/do_task/circle_1",function(){return n(1563)}])},8104:function(t,e,n){"use strict";n.d(e,{K:function(){return r}});var r=(0,n(2804).cn)({key:"user",default:{name:""}})},1563:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return p}});var r=n(4051),a=n.n(r),o=n(5893),u=n(9008),i=n.n(u),c=n(7294),s=n(3328),l=n(2804),f=n(8104),h=function(t,e){e.map((function(e,n){t.beginPath(),t.arc(e.x,e.y,e.r,0,2*Math.PI,!0),t.setLineDash([5,5]),t.strokeStyle="black",t.lineWidth=1,t.stroke()}))},y=function(t,e){console.log(t);var n=[];return e.map((function(e,r){n.push([]);for(var a=0;a<100;a++)for(var o={x:e.r*Math.cos(2*Math.PI/100*a)+e.x,y:e.r*Math.sin(2*Math.PI/100*a)+e.y},u={a:o.y-e.y,b:-o.x+e.x,c:(o.x-e.x)*e.y-(o.y-e.y)*e.x},i=0;i<t.length;i++){var c=t[i];if(void 0!=c)if(0!=c.length)if(!(Math.sqrt((c[0].x-e.x)*(c[0].x-e.x)+(c[0].y-e.y)*(c[0].y-e.y))>=2*e.r))for(var s=1;s<c.length;s++){var l=c[s-1],f=c[s-0],h={a:l.y-f.y,b:-l.x+f.x,c:(l.x-f.x)*f.y-(l.y-f.y)*f.x};if(!((u.a*f.x+u.b*f.y+u.c)*(u.a*l.x+u.b*l.y+u.c)>=0)){var y=u.a*h.b-h.a*u.b;if(0!=y){var d={x:(u.b*h.c-h.b*u.c)/y,y:(h.a*u.c-u.a*h.c)/y},x={x:o.x-e.x,y:o.y-e.y},v=Math.sqrt(x.x*x.x+x.y*x.y);x.x/=v,x.y/=v;var m=(d.x-o.x)*x.x+(d.y-o.y)*x.y;if(Math.abs(m)>=e.r)continue;var p=Math.abs(d.x-l.x),g=Math.abs(d.x-f.x);if(0==p&&0==g)if(p=Math.abs(d.y-l.y),g=Math.abs(d.y-f.y),0==p&&0==g)n[n.length-1].push({index:a,t:f.t,x_target:o.x,y_target:o.y,x:d.x,y:d.y,d:m,f:f.f,altitude:f.altitude,azimuth:f.azimuth});else{var b=p/(p+g)*f.f+g/(p+g)*l.f,w=p/(p+g)*f.altitude+g/(p+g)*l.altitude,_=p/(p+g)*f.azimuth+g/(p+g)*l.azimuth,k=p/(p+g)*f.t+g/(p+g)*l.t;n[n.length-1].push({index:a,t:k,x_target:o.x,y_target:o.y,x:d.x,y:d.y,d:m,f:b,altitude:w,azimuth:_})}else{var S=p/(p+g)*f.f+g/(p+g)*l.f,j=p/(p+g)*f.altitude+g/(p+g)*l.altitude,A=p/(p+g)*f.azimuth+g/(p+g)*l.azimuth,E=p/(p+g)*f.t+g/(p+g)*l.t;n[n.length-1].push({index:a,t:E,x_target:o.x,y_target:o.y,x:d.x,y:d.y,d:m,f:S,altitude:j,azimuth:A})}break}}}}})),n},d=n(1163);function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function v(t,e,n,r,a,o,u){try{var i=t[o](u),c=i.value}catch(s){return void n(s)}i.done?e(c):Promise.resolve(c).then(r,a)}function m(t){return function(t){if(Array.isArray(t))return x(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return x(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}s.kL.register(s.f$,s.od,s.jn,s.u,s.De);var p=function(){var t=(0,d.useRouter)(),e=(0,c.useRef)(null),n=(0,c.useState)(null),r=n[0],u=n[1],s=(0,c.useState)(null),x=s[0],p=s[1],g=(0,c.useState)({w:0,h:0}),b=g[0],w=g[1],_=(0,c.useState)([]),k=_[0],S=_[1],j=(0,c.useRef)(),A=(0,c.useRef)(),E=(0,c.useState)([]),M=E[0],z=E[1],N=(0,c.useState)([]),P=N[0],T=N[1],C=(0,c.useState)(0),L=C[0],I=C[1],O=-10,R=-10,D=(0,l.sJ)(f.K);(0,c.useEffect)((function(){w({w:window.innerWidth,h:window.innerHeight});var t=[];t.push({x:100,y:200,r:50},{x:300,y:200,r:50},{x:500,y:200,r:50},{x:700,y:200,r:50},{x:100,y:400,r:50},{x:300,y:400,r:50},{x:500,y:400,r:50},{x:700,y:400,r:50},{x:100,y:600,r:50},{x:300,y:600,r:50},{x:500,y:600,r:50},{x:700,y:600,r:50}),S(t),I(performance.now())}),[]),(0,c.useEffect)((function(){console.log(b),null==r?u(e.current):p(r.getContext("2d"))}),[b]),(0,c.useEffect)((function(){if(null!=x){r.style.width=b.w,r.style.height=b.h,r.width=b.w,r.height=b.h,h(x,k);var t=!0,e=!1,n=void 0;try{for(var a,o=["touchstart","mousedown"][Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var u=a.value;r.addEventListener(u,(function(t){console.log("touch start"),T(m(A.current).concat([[]]))}))}}catch(S){e=!0,n=S}finally{try{t||null==o.return||o.return()}finally{if(e)throw n}}var i=!0,c=!1,s=void 0;try{for(var l,f=["touchend","mouseup"][Symbol.iterator]();!(i=(l=f.next()).done);i=!0){var y=l.value;r.addEventListener(y,(function(t){console.log("touch end"),O=-10,R=-10}))}}catch(S){c=!0,s=S}finally{try{i||null==f.return||f.return()}finally{if(c)throw s}}var d=!0,v=!1,p=void 0;try{for(var g,w=["touchmove","mousemove"][Symbol.iterator]();!(d=(g=w.next()).done);d=!0){var _=g.value;r.addEventListener(_,(function(t){t.preventDefault();var e,n;if(null!=t.touches&&"undefined"!=t.touches[0].touchType&&"stylus"==t.touches[0].touchType){t.touches&&t.touches[0]&&"undefined"!==typeof t.touches[0].force&&t.touches[0].force>0&&t.touches[0].force;var r=t.touches?t.touches[0]:null;if(r){if(e=t.touches[0].pageX-t.target.offsetLeft,n=t.touches[0].pageY-t.target.offsetTop,-10==O)return O=e,void(R=n);void 0==r.altitudeAngle&&(r.altitudeAngle=-10,r.azimuthAngle=-10);var a=performance.now(),o=A.current;o[o.length-1].push({x:e,y:n,t:a-L,f:r.force,altitude:r.altitudeAngle,azimuth:r.azimuthAngle}),T(m(o)),z(m(j.current).concat([{x:e,y:n,t:a-L,f:r.force,altitude:r.altitudeAngle,azimuth:r.azimuthAngle}])),0!=r.force&&(x.beginPath(),x.moveTo(O,R),x.lineTo(e,n),x.lineCap="round",x.strokeStyle="blue",x.setLineDash([]),x.lineWidth=1,x.stroke())}O=e,R=n}}))}}catch(S){v=!0,p=S}finally{try{d||null==w.return||w.return()}finally{if(v)throw p}}}}),[x]),(0,c.useEffect)((function(){j.current=m(M)}),[M]),(0,c.useEffect)((function(){A.current=m(P)}),[P]);var W=function(){var e,n=(e=a().mark((function e(n){var r,o,u,i,c,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=y(P,k),(o={}).task={username:D.name,type:"circle_1"},o.results=[],k.map((function(t,e){var n=r[e],a=0;n.map((function(t){a+=Math.abs(t.d)})),0!=n.length?(a/=n.length,a=100*(1-5*(a/=t.r))):a=-1,o.results.push({type:"circle",score:a,x:t.x,y:t.y,r:t.r})})),o.results_time_series=r,console.log(o),u=0,i=0,o.results.map((function(t,e){(t.score-=-1)&&(u+=t.score,i++)})),0!=i?u/=i:u=0,e.next=13,fetch("".concat("https","://").concat("lab.nghmst.com/sketch_hit/backend","/save_result"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).catch((function(){return null}));case 13:return c=e.sent,e.next=16,c.json().catch((function(){return null}));case 16:s=e.sent,console.log(s),0==s.result?(alert("\u9001\u4fe1\u304c\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002\u30b9\u30b3\u30a2\u306f".concat(u,"\u3067\u3059\u3002")),t.push("/select_task")):alert("\u9001\u4fe1\u306b\u5931\u6557\u3057\u307e\u3057\u305f");case 20:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function u(t){v(o,r,a,u,i,"next",t)}function i(t){v(o,r,a,u,i,"throw",t)}u(void 0)}))});return function(t){return n.apply(this,arguments)}}(),X=function(){z([]),T([]),x.clearRect(0,0,r.width,r.height),h(x,k)};return(0,o.jsxs)("div",{children:[(0,o.jsxs)(i(),{children:[(0,o.jsx)("title",{children:"Apple Pencil Test"}),(0,o.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,o.jsx)("div",{className:"relative",children:(0,o.jsx)("canvas",{ref:e,className:"absolute bg-gradient-to-br from-slate-300 to-slate-400"})}),(0,o.jsxs)("div",{className:"absolute top-8 left-72 mx-auto flex flex-col justify-center",children:[(0,o.jsxs)("div",{className:"mb-2",children:["\u3042\u306a\u305f\u306e\u540d\u524d\uff1a ",D.name]}),(0,o.jsx)("div",{children:"\u70b9\u7dda\u306e\u5186\u3092\u306a\u305e\u3063\u3066\u304f\u3060\u3055\u3044"})]}),(0,o.jsx)("div",{className:"absolute top-4 right-4 rounded-md bg-orange-800 px-4 py-2 text-white",onClick:function(t){return W(t)},children:"\u7d50\u679c\u3092\u9001\u4fe1"}),(0,o.jsx)("div",{className:"absolute top-4 left-4 rounded-md bg-black px-2 py-2 text-white",onClick:function(t){X()},children:"clear canvas"})]})}}},function(t){t.O(0,[570,865,774,888,179],(function(){return e=3825,t(t.s=e);var e}));var e=t.O();_N_E=e}]);